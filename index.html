<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le R√¥t-Piano (Real Burp) ü§¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik+Distressed&family=Fredoka:wght@400;600&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background: radial-gradient(circle at center, #ecfccb 0%, #3f6212 100%); /* Lime to dark green */
            touch-action: manipulation;
            overflow: hidden;
        }

        .piano-title {
            font-family: 'Rubik Distressed', cursive;
            text-shadow: 4px 4px 0px rgba(0,0,0,0.2);
        }

        .piano-container {
            perspective: 1000px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .key {
            transition: all 0.1s ease;
            position: relative;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transform-origin: top center;
        }

        .white-key {
            background: linear-gradient(180deg, #ffffff 0%, #f0fdf4 100%);
            box-shadow: 
                0 4px 5px rgba(0,0,0,0.1),
                inset 0 -5px 10px rgba(0,0,0,0.1), 
                inset 0 0 5px rgba(255,255,255,0.5);
            z-index: 1;
            border-radius: 0 0 8px 8px;
            height: 14rem;
            border-bottom: 8px solid #86efac; /* Green tint bottom */
        }

        .white-key:active, .white-key.active {
            transform: rotateX(-3deg) translateY(4px);
            background: linear-gradient(180deg, #dcfce7 0%, #bbf7d0 100%);
            border-bottom: 2px solid #86efac;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }

        .black-key {
            background: linear-gradient(180deg, #1a2e05 0%, #365314 100%);
            box-shadow: 
                2px 4px 5px rgba(0,0,0,0.4),
                inset 0 2px 2px rgba(255,255,255,0.1);
            z-index: 2;
            height: 8.5rem;
            width: 3.5rem;
            margin-left: -1.75rem;
            margin-right: -1.75rem;
            border-radius: 0 0 4px 4px;
            border-bottom: 4px solid #14532d;
        }

        .black-key:active, .black-key.active {
            transform: rotateX(-3deg) translateY(4px);
            background: #14532d;
            border-bottom: 1px solid #14532d;
        }

        /* Gas Particle Animation */
        .gas-particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(163,230,53,0.8) 0%, rgba(163,230,53,0) 70%);
            animation: floatGas 1.5s ease-out forwards;
            opacity: 0;
            z-index: 50;
        }

        .emoji-float {
            position: absolute;
            font-size: 2rem;
            pointer-events: none;
            animation: floatUp 1.2s ease-out forwards;
            z-index: 51;
        }

        @keyframes floatGas {
            0% { transform: scale(0.2) translateY(0); opacity: 0.6; }
            50% { transform: scale(1.5) translateY(-50px); opacity: 0.3; }
            100% { transform: scale(2) translateY(-100px); opacity: 0; }
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-120px) rotate(20deg); opacity: 0; }
        }

        /* Loading Screen */
        #loader {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, #f7fee7 0%, #ecfccb 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-center;
            z-index: 100;
            transition: opacity 0.5s ease;
        }
        .loader-hidden { opacity: 0; pointer-events: none; }
        
        .pulse-ring {
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(101, 163, 13, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(101, 163, 13, 0); }
            100% { box-shadow: 0 0 0 0 rgba(101, 163, 13, 0); }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center text-lime-900 selection:bg-lime-200">

    <!-- Loader -->
    <div id="loader">
        <div class="relative mb-6">
            <div class="text-8xl animate-bounce z-10 relative">ü§¢</div>
            <div class="absolute inset-0 bg-lime-500 rounded-full blur-xl opacity-20 pulse-ring"></div>
        </div>
        <h2 class="text-3xl font-bold text-lime-800 piano-title tracking-widest">CHARGEMENT</h2>
        <p class="text-lime-600 mt-2 font-mono" id="status-text">Recherche du fichier audio...</p>
        <div class="w-64 h-2 bg-lime-200 rounded-full mt-4 overflow-hidden">
            <div id="progress-bar" class="h-full bg-lime-600 w-0 transition-all duration-300"></div>
        </div>
    </div>

    <!-- Main UI -->
    <div class="text-center mb-8 px-4 relative z-10">
        <div class="inline-block bg-white/30 backdrop-blur-sm p-4 rounded-2xl border border-white/50 shadow-xl mb-4">
            <h1 class="text-5xl md:text-7xl mb-0 piano-title text-lime-900 flex items-center gap-4">
                <span>ü§¢</span> Le R√¥t-Piano <span>ü§Æ</span>
            </h1>
            <p class="text-lime-800 font-bold tracking-wide text-sm md:text-base mt-2 uppercase opacity-80">
                √âdition "Vrais Sons"
            </p>
        </div>
        
        <div class="flex gap-3 justify-center text-xs font-mono">
            <div class="bg-lime-900/10 backdrop-blur px-3 py-1 rounded border border-lime-900/20 text-lime-900">
                SRC: <strong>GitHub Raw</strong>
            </div>
            <div class="bg-lime-900/10 backdrop-blur px-3 py-1 rounded border border-lime-900/20 text-lime-900">
                FX: <strong>Varispeed</strong>
            </div>
        </div>
    </div>

    <!-- Piano Deck -->
    <div class="relative group">
        <!-- Decor background behind piano -->
        <div class="absolute -inset-4 bg-lime-900/20 rounded-[2rem] blur-xl transform group-hover:scale-105 transition duration-500"></div>
        
        <div class="piano-container bg-gradient-to-b from-lime-800 to-lime-950 p-6 pt-8 rounded-t-xl rounded-b-3xl relative z-20 border-t-8 border-lime-700">
            <!-- Brand Plate -->
            <div class="absolute top-2 left-0 right-0 text-center pointer-events-none">
                <span class="text-lime-900/40 font-serif italic text-sm">Burpway & Sons</span>
            </div>

            <div class="flex justify-center items-start relative px-2" id="keyboard">
                <!-- Keys will be injected here -->
            </div>
        </div>
    </div>

    <div class="mt-8 text-center space-y-2">
        <p class="text-lime-900/70 font-medium text-sm">
            Cliquez ou utilisez votre clavier <span class="bg-white/40 px-1 rounded border border-lime-900/10">A</span> √† <span class="bg-white/40 px-1 rounded border border-lime-900/10">K</span>
        </p>
        <p class="text-xs text-lime-900/40">
            Fichier audio source : Storm99999/whitelistkeys (GitHub)
        </p>
    </div>

    <script>
        // --- Audio Engine ---
        let audioCtx;
        let masterBurpBuffer = null;
        
        // C'est LE fichier. Un vrai rot, trouv√© dans les tr√©fonds de GitHub.
        // Source: Un script Lua pour Roblox h√©berg√© sur GitHub.
        const BURP_URL = "https://raw.githubusercontent.com/Storm99999/whitelistkeys/main/aimhook/sounds/burp.mp3";

        // Fallback sounds (des fois que le premier lien meure)
        const FALLBACK_URL = "https://raw.githubusercontent.com/raspberrypilearning/burping-jelly-baby/master/burp.wav";

        const visualEmojis = ["ü§¢", "ü§Æ", "üó£Ô∏è", "ü•¥", "üç∫", "ü•ì", "üçî", "üçï"];

        // D√©finition des touches et de leur "vitesse" de lecture (Playback Rate)
        // 0.5 = Ralenti 2x (Tr√®s grave)
        // 1.0 = Vitesse normale
        // 1.5 = Acc√©l√©r√© (Aigu)
        const keysConfig = [
            { id: "C3", label: "Gros",  color: "w", key: "a", rate: 0.5 }, // Le rot de l'ogre
            { id: "Db3", label: "",     color: "b", key: "w", rate: 0.55 },
            { id: "D3", label: "Gras",  color: "w", key: "s", rate: 0.6 },
            { id: "Eb3", label: "",     color: "b", key: "e", rate: 0.65 },
            { id: "E3", label: "Lourd", color: "w", key: "d", rate: 0.7 },
            { id: "F3", label: "Moyen", color: "w", key: "f", rate: 0.8 },
            { id: "Gb3", label: "",     color: "b", key: "t", rate: 0.85 },
            { id: "G3", label: "Normal",color: "w", key: "g", rate: 1.0 }, // Le son original
            { id: "Ab3", label: "",     color: "b", key: "y", rate: 1.1 },
            { id: "A3", label: "Sec",   color: "w", key: "h", rate: 1.2 },
            { id: "Bb3", label: "",     color: "b", key: "u", rate: 1.3 },
            { id: "B3", label: "Petit", color: "w", key: "j", rate: 1.4 },
            { id: "C4", label: "B√©b√©",  color: "w", key: "k", rate: 1.6 }  // Chipmunk
        ];

        async function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                await audioCtx.resume();
            }
        }

        async function loadAudio() {
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');

            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                statusText.innerText = "T√©l√©chargement du rot...";
                progressBar.style.width = "40%";

                // Tentative de chargement
                let response = await fetch(BURP_URL);
                if (!response.ok) {
                    console.warn("Lien principal HS, tentative fallback...");
                    response = await fetch(FALLBACK_URL);
                }

                progressBar.style.width = "70%";
                statusText.innerText = "D√©codage des gaz...";

                const arrayBuffer = await response.arrayBuffer();
                masterBurpBuffer = await audioCtx.decodeAudioData(arrayBuffer);

                progressBar.style.width = "100%";
                statusText.innerText = "Pr√™t √† r√¥tir !";
                
                setTimeout(() => {
                    document.getElementById('loader').classList.add('loader-hidden');
                }, 500);

            } catch (error) {
                console.error(error);
                statusText.innerText = "Erreur : Impossible de charger le son :(";
                statusText.style.color = "red";
            }
        }

        function playBurp(rate) {
            if (!audioCtx || !masterBurpBuffer) return;

            // Cr√©ation de la source
            const source = audioCtx.createBufferSource();
            source.buffer = masterBurpBuffer;

            // Variation al√©atoire l√©g√®re pour le r√©alisme (+/- 5%)
            const randomVar = 1 + (Math.random() * 0.1 - 0.05);
            const finalRate = rate * randomVar;
            
            source.playbackRate.value = finalRate;

            // Filtre (Lowpass) pour les sons ralentis (graves) afin d'√©viter le cr√©pitement digital
            // et renforcer le c√¥t√© "caverneux"
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            // Plus c'est lent, plus on ferme le filtre
            filter.frequency.value = finalRate < 0.8 ? 1500 : 20000;

            // Gain (Volume)
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 1.0;

            // Cha√Æne : Source -> Filtre -> Gain -> Sortie
            source.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            source.start(0);
        }

        function createVisuals(keyElement) {
            // 1. Gas Cloud
            const rect = keyElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const topY = rect.top;

            const gas = document.createElement('div');
            gas.className = 'gas-particle';
            const size = Math.random() * 40 + 40; // 40-80px
            gas.style.width = `${size}px`;
            gas.style.height = `${size}px`;
            gas.style.left = `${centerX - size/2}px`;
            gas.style.top = `${topY - size/2}px`;
            document.body.appendChild(gas);

            // 2. Emoji
            const emoji = document.createElement('div');
            emoji.className = 'emoji-float';
            emoji.innerText = visualEmojis[Math.floor(Math.random() * visualEmojis.length)];
            emoji.style.left = `${centerX + (Math.random()*20-10)}px`;
            emoji.style.top = `${topY - 20}px`;
            document.body.appendChild(emoji);

            // Cleanup
            setTimeout(() => gas.remove(), 1500);
            setTimeout(() => emoji.remove(), 1200);
        }

        // --- Keyboard Generation ---
        const keyboardEl = document.getElementById('keyboard');

        keysConfig.forEach(conf => {
            const key = document.createElement('div');
            
            // Classes conditionnelles
            let baseClass = "key flex flex-col justify-end items-center pb-4 text-xs font-bold";
            if (conf.color === 'w') {
                key.className = `${baseClass} white-key w-10 md:w-14 text-lime-900/50`;
                key.innerHTML = `<span class="mb-2">${conf.label}</span><span class="text-[10px] opacity-50 uppercase">${conf.key}</span>`;
            } else {
                key.className = `${baseClass} black-key text-lime-100/50`;
            }
            
            key.dataset.key = conf.key;

            const trigger = async (e) => {
                if (e.cancelable && e.type === 'touchstart') e.preventDefault();
                
                await initAudioContext();

                // Visual Key Press
                key.classList.add('active');
                setTimeout(() => key.classList.remove('active'), 150);

                // Audio & Visuals
                playBurp(conf.rate);
                createVisuals(key);
            };

            key.addEventListener('mousedown', trigger);
            key.addEventListener('touchstart', trigger);
            
            keyboardEl.appendChild(key);
        });

        // --- Global Events ---
        window.addEventListener('keydown', (e) => {
            if (e.repeat) return;
            const k = e.key.toLowerCase();
            const conf = keysConfig.find(c => c.key === k);
            if (conf) {
                const el = document.querySelector(`div[data-key="${k}"]`);
                if (el) {
                    initAudioContext();
                    el.classList.add('active');
                    playBurp(conf.rate);
                    createVisuals(el);
                }
            }
        });

        window.addEventListener('keyup', (e) => {
            const k = e.key.toLowerCase();
            const el = document.querySelector(`div[data-key="${k}"]`);
            if (el) el.classList.remove('active');
        });

        // Init Load
        window.addEventListener('load', loadAudio);

    </script>
</body>
</html>
